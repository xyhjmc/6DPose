# configs/default.yaml
#
# ============================================
#         默认训练配置文件 (Base Config)
# ============================================
# 定义所有实验共享的“模板”。
# 具体的实验配置文件 (e.g., ape.yaml) 必须覆盖
# 所有被设为 'null' 的路径。
# ============================================

seed: 42
device: "cuda"

# --- 1. 运行与路径设置 ---
run:

  # [修改] 路径应在具体配置中指定
  log_dir: null # (例如: "./logs/pvnet_linemod_ape")
  checkpoint_dir: null # (例如: "./checkpoints/pvnet_linemod_ape")
  resume: true

# --- 2. 数据集与加载器 ---
dataset:
  data_root: null
  # [关键修改] 路径设为 null，强制在实验配置中覆盖
  train_data_dir: null # (必须覆盖!)
  val_data_dir: null   # (必须覆盖!)
  kp3d_path: null      # (可选) 共享的 3D 关键点文件路径

  num_workers: 8
  pin_memory: true

  loader:
    batch_size: 8
    shuffle: true
    drop_last: true

# --- 3. 数据增强与变换 ---
transforms:
  # [关键] 必须与 prepare_bop_dataset_pro.py 的设置匹配
  use_offset: true # (用于 SmoothL1Loss)

  input_size_hw: [256, 256] # (H, W) - ROI Patch 训练默认值

  # ROI 裁剪配置
  crop:
    enabled: true
    pad_scale_range: [1.1, 1.4]
    jitter_ratio: 0.1
    min_side: 32

  augmentation:
    degrees: 30.0
    scale_range: [0.8, 1.2]
    flip_p: 0.5

  color_jitter:
    brightness: 0.2
    contrast: 0.2
    saturation: 0.2

  mean: [0.485, 0.456, 0.406]
  std: [0.229, 0.224, 0.225]

# --- 4. 模型参数 ---
model:
  name: "PVNet"
  num_keypoints: 9
  ver_dim: 18 # (num_keypoints * 2)
  seg_dim: 2  # (背景, 前景)

  # 顶点缩放因子，ROI 模式下保持 1.0，更易于稳定训练
  vertex_scale: 1.0

  ransac_voting:
    vote_num: 512
    inlier_thresh: 2.0
    max_trials: 200


# --- 5. 损失函数参数 ---
loss:
  seg_loss_type: "focal"
  seg_focal_gamma: 2.0
  seg_focal_alpha: 0.75
  seg_class_weights: null
  seg_weight: 10.0
  vote_weight: 1.0
  vote_smooth_l1_beta: 0.1
  vote_normalize_eps: 0.0
  skip_vote_if_no_fg: false

# --- 6. 优化器 ---
optimizer:
  type: "Adam"
  lr: 0.001
  weight_decay: 0.0

# --- 7. 学习率调度器 ---
scheduler:
  type: "MultiStepLR"
  milestones: [60, 80]
  gamma: 0.1
  # ReduceLROnPlateau 专用参数（当 type 设置为 ReduceLROnPlateau 时生效）
  factor: 0.1
  patience: 10
  threshold: 0.0001
  cooldown: 0
  min_lr: 0.0

# --- 8. 训练引擎参数 ---
train:
  max_epochs: 100
  use_amp: true
  log_interval: 50
  grad_clip_norm: 5.0

# --- 9. 评估器参数 ---
pnp:
  reproj_error_thresh: 3.0